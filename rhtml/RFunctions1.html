<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Figures: Tatsuki Koyama</title>
    <link rel="stylesheet" href="../assets/css/Feb2025.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
<!-- Highlight.js CSS (Choose a theme) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/idea.min.css">
<!-- Highlight.js Library -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/r.min.js"></script> -->
<!-- Initialize Highlight.js -->
<script>hljs.highlightAll();</script>
    <script>
        function toggleVisibility(id) {
            var element = document.getElementById(id);
            if (element.style.display === "none") {
                element.style.display = "block";
            } else {
                element.style.display = "none";
            }
        }
    </script>
</head>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
<body>
    <div class="container-box">
    <div class="navbar"> 
        <nav>
        <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="../rhtml/RFunctions1.html"><img src="../assets/images/Rlogo.svg" alt="R Logo" width="20"> files</a></li>
        <li><a href="../teaching.html">Teaching</a></li>
        <li><a href="../cv.html">CV</a></li>
        </ul>
        </nav>
    </div>
<!-- ------ --> 
<main>
    <aside class="sidebar">
        <img src="../assets/images/tatsuki-koyama.png" alt="Tatsuki Koyama" class="profile-pic">
        <h2>Tatsuki Koyama</h2>
        <p><a href="https://www.vumc.org/biostatistics/">Department of Biostatistics</a><br><a href="https://vanderbilt.edu">Vanderbilt University</a><br><a href="https://www.vumc.org/main/home">Medical Center</a></p>
        <p>Nashville, TN</p>
            <ul class="social-links"> 
            <li><a href="mailto:tatsuki.koyama@vumc.org"><i class="fa-solid fa-envelope"></i> Email</a></li>
            <li><a href="https://scholar.google.com/citations?user=BEg13Y0AAAAJ&hl=en"><i class="fa-solid fa-graduation-cap"></i> Google Scholar</a></li>
            <li><a href="https://www.athlinks.com/athletes/155884025"><i class="fa fa-link"></i> Athlinks</a></li>
            </ul>
    </aside>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
<section class="content">
<h1>R Functions</h1>
    <div class="r-functions-links" style="display: flex; justify-content: space-around; margin-bottom: 20px;">
    <a href="RFunctions1.html">Custom Figures</a>
    <a href="RFunctions2.html">Misc Functions</a>
    <a href="TwoStage2025.html">Two-Stage Designs</a>
    </div>
<!--        --> 
<div class="r-functions-list">
<h2>Custom Figures</h2>
<p><a href="https://github.com/tk-koyama/rFunctions/blob/main/RFunctions1.R" target="_blank"> Download RFunctions1.R (GitHub) </a> </p>

<ul>
<!-- ------ --> 
<!-- dbplot  -->
<!--        --> 
<!-- ------ --> 
<li>
<button onclick="toggleVisibility('dbplot-details')">dbplot</button>
<div id="dbplot-details" style="display: none;">
<p><strong>dbplot()</strong> is a dot plot/box plot that displays individual data points, with automatic jittering when needed.</p>

<p>Its predecessor, <code class="cxx">tplot()</code>, was written over a decade ago. This new <code class="cxx">dbplot()</code> builds upon it, offering enhanced functionality. While <code class="cxx">beeswarm()</code> in beeswarm package provides similar capabilities, <code class="cxx">dbplot()</code> includes controls that better align with my taste and preferences.</p>

<h3>Inputs</h3> Only <span class="cx">y</span> is absolutely required.
<h4>Main arguments</h4>
<ul>
    <li><span class="cx">y</span> A numeric vector to be plotted.</li>
    <li><span class="cx">g</span> A grouping vector.</li>
    <li><span class="cx">clustering_distance</span> Controls which data points are considered part of the same cluster and thus jittered. 
        <ul><li>If <span class="cxx">NULL</span>, the function determines a reasonable value, and it is returned if <span class="cxx">output=TRUE</span>.</li> 
            <li>Setting <span class="cxx">clustering_distance=0</span> disables jittering.</li>
        </ul></li>
    <li><span class="cx">jitter_amount</span> Controls jitter distance.
        <ul><li>If <span class="cxx">NULL</span>, the function determines a reasonable value, and it is returned if <span class="cxx">output=TRUE</span>.</li>
            <li>Setting <span class="cxx">jittering_amount=0</span> disables jittering.</li>
        </ul></li>
    <li><span class="cx">output</span> If TRUE, returns the clustering result, <span class="cxx">clustering_distance</span>, and <span class="cxx">jittering_amount</span>.</li>
    <li><span class="cx">group_names</span> A vector of group names, defaulting to the factor levels of <span class="cxx">g</span>. </li>
    <li><span class="cx">group_positions</span> By default, data are plotted at <span class="cxx">x=1, 2, 3, ...</span> unless <span class="cxx">group_positions</span> are specified.</li>
</ul>
<h4>Color and Point Character</h4>
<ul>
    <li><span class="cx">indiv_col</span> A vector of individula colors for <span class="cxx">y</span>.</li>
    <li><span class="cx">group_col</span> Specifies group colors, 
        <ul><li>Each group can have different colors, but this is redundant information.</li> 
            <li>If a single color is provided, all data points are drawn in that color.</li>
        </ul>
    <li><span class="cx">indiv_pch</span> See <span class="cxx">indiv_col</span>.</li>
    <li><span class="cx">group_pch</span> See <span class="cxx">group_col</span>.</li>
</ul>
<h4>Handling Missing Group</h4>
<ul>
    <li><span class="cx">NA_as_group</span> If TRUE, missing values in <span class="cxx">g</span> are treated as a separate group.</li>
    <li><span class="cx">NA_group_name</span> Defaults to "Missing".</li>
    <li><span class="cx">NA_group_position</span> The plotting position of the missing group, defaulting to the far right.</li>
    <li><span class="cx">NA_group_col</span> The color for the "Missing" group.</li> 
    <li><span class="cx">NA_group_pch</span> The pch (plotting character) for the "Missing" group.</li>
</ul>
<h4>Boxplot</h4>
<ul><li><span class="cx">box_col</span> Boxplot colors, which can be specified for each group.</li>
    <li><span class="cx">NA_box_col</span> Boxplot color for the "Missing" group.</li>
</ul>
<h4>Other Specifications</h4>
<ul>
    <li><span class="cx">grid_x</span> Draws horizontal grid lines at specified values.</li>
    <li><span class="cx">grid_y</span> Draws vertical grid lines at specified values. <small>(a little silly)</small></li>
    <li><span class="cx">show_n</span> If TRUE, displays sample sizes.</li>
</ul>
    
<h4>Figure Type Options</h4>
    <ul>
    <li><span class="cx">fig_type</span>Figure type options.
        <ul><li><span class="cxx">b</span>: Boxplot</li> 
            <li><span class="cxx">d</span>: Dot plot</li>
            <li><span class="cxx">db</span>: Dot over boxplot</li>
            <li><span class="cxx">bd</span>: Box over dot plot (very silly)</li>
        </ul>
    <li><span class="cx">NA_fig_type</span> Figure type for "Missing" group.</li>
</ul>

<h4>Additional Inputs</h4> 
<ul>
    <li><span class="cx">grid_par</span> A list of paraameters to pass to the <span class="cxx">abline()</span> function for drawing grid lines. (<span class="cxx">col</span>, <span class="cxx">lty</span>, <span class="cxx">lwd</span>).  </li>
</ul>
The following arguments are passed to <span class="cxx">plot()</span>, <span class="cxx">points()</span>, <span class="cxx">boxplot()</span> functions.
<ul>
    <li><span class="cx">plot()</span> main, sub, xlab, ylab, xlim, ylim, axes, frame.plot.</li>
    <li><span class="cx">points()</span> cex, bg.</li> 
    <li><span class="cx">boxplot()</span> range, notch, border, boxwex.</li> 
</ul>

<h3>Example</h3>
<pre><code class="code-block">
set.seed(620)
y <- rnorm(100, mean=100, sd=40)
g <- factor(sample(c('C','B','R'), length(y), rep=TRUE), levels=c('C','B','R'))
some_factor <- sample(c('A','B'), length(y), rep=TRUE)
    color_map <- c('A'='darkorange', 'B'='mediumslateblue')
    colors <- color_map[some_factor]
        y[ sample(seq_along(y), 5, rep=FALSE) ] <- NA
        g[ sample(seq_along(g), 4, rep=FALSE) ] <- NA

dbplot(y, g, group_names=c('Cat','Bat','Rat'), 
           indiv_col=colors, group_pch=19, 
           NA_as_group=TRUE, NA_group_name='?', NA_group_position=5,
           box_col=c('grey80','grey90','lightgoldenrodyellow'),
           grid_y=seq(0,250,by=50), show_n=TRUE, 
           fig_type=c('b','d','db'), NA_fig_type='d', 
           grid_par=list(col='skyblue', lty=1, lwd=1), 
           clustering_distance=NULL, jitter_amount=NULL,
           ylim=c(0,250), xlab='Animal', ylab='Score', # passed to plot()
           cex=1.2, # passed to points()
           boxwex=0.6, border='royalblue' # passed to boxplot()
           )
</code></pre>

<img src="../assets/images/dbplot1.png" alt="jmplot example", width="80%">

</div>
</li>


<!-- ------ -->
<!-- kmplot -->
<!--        -->
<!-- ------ -->
<li><button onclick="toggleVisibility('kmplot-details')">kmplot</button>
<div id="kmplot-details" style="display: none;">

<p>The <strong>kmplot()</strong> function generates Kaplan-Meier survival curves with various customization options, including a flexible "number at risk" table:
<ul>
    <li>The ability to customize the order of appearance to approximately match the curves.</li>
    <li>The ability to specify the time points where numbers are displayed.</li>
</ul> </p>
<p>Other functionalities are demonstrated in the example below.</p>



<!--        -->
<h3>Inputs</h3>
<h4>Main Arguments</h4>
<ul>
    <li><span class="cx">km</span> Output of <span class="cxx">survfit()</span></li>
    <li><span class="cx">mark</span> Tick mark style. The same as <span class="cxx">pch</span>.</li>
    <li><span class="cx">simple</span> If TRUE, the 'at risk' table will not be produced.</li>
    <li><span class="cx">xaxis.at</span> Specifies time positions where 'at risk' numbers are computed and displayed.</li>
    <li><span class="cx">xaxis.lab</span> Labels for the x-axis. Useful e.g., when time is in days but labels in year are preferred.</li>
</ul>
<h4>line Specifications</h4>
<ul>
    <li><span class="cx">lty.surv</span> Line type for survival curves</li>
    <li><span class="cx">lwd.surv</span> Line width for survival curves</li>
    <li><span class="cx">col.surv</span> Color for survival curves</li>
    <li><span class="cx">lty.ci</span> Line type for confidence intervals</li>
    <li><span class="cx">lwd.ci</span> Line width for confidence intervals</li>
    <li><span class="cx">col.ci</span> Color for confidence intervals</li>

</ul>
<h4>At Risk Table</h4>
<ul>
    <li><span class="cx">group.names</span> Names displayed in the 'at risk' table and legend.</li>
    <li><span class="cx">group.order</span> Reorders groups in the 'at risk' table to approximately match appearance of survival curves.</li>
    <li><span class="cx">extra.left.margin</span> Adds extra space when group names are long.</li>
    <li><span class="cx">label.n.at.risk</span> If TRUE, labels the 'N at risk' table.</li>
    <li><span class="cx">draw.lines</span> Draws lines to specifies survival curves. <small>(Not sure why this is optional)</small></li>
    <li><span class="cx">cex.axis</span> Controls cex.axis and the text size of the 'N at risk' table.</li>

</ul>
<h4>Figure Appearances</h4>
<ul>
    <li><span class="cx">xlab</span> X-axis label</li>
    <li><span class="cx">ylab</span> Y-axis label</li>
    <li><span class="cx">main</span> Plot title</li>
    <li><span class="cx">xlm</span> Passed to xlim</li>
    <li><span class="cx">ylm</span> Passed to ylim</li>

</ul>
<h4>Grid</h4>
<ul>
    <li><span class="cx">grid</span> If TRUE, draws grid lines. Vertical lines appear at <span class="cxx">xaxis.at</span> locations, and horizontal lines at <span class="cxx">pretty(0,1)</span> locations.</li>
    <li><span class="cx">lty.grid</span> Line type for grid</li>
    <li><span class="cx">lwd.grid</span> Line width for grid</li>
    <li><span class="cx">col.grid</span> Color for grid</li>

</ul>
<h4>Legend</h4>
<ul>
    <li><span class="cx">legend</span> Enables/disables the legend</li>
    <li><span class="cx">loc.legend</span> Controls legend position</li>

</ul>
<h4>Other</h4>
<ul>
    <li><span class="cx">add</span> If TRUE, adds to an existing plot.</li>
    <li><span class="cx">returnOutput</span> If TRUE, returns the output of <span class="cxx">survfit()</span>.</li>
        <li><span class="cx">...</span> Additional arguments passed to <span class="cxx">par()</span>.</li>
</ul>

<br>

<!--        --> 
<h3>Example</h3>
<pre><code class="code-block">require(survival)

kma <- survfit( Surv(time, status) ~ rx + adhere, data=colon )
kmplot(kma, mark='', simple=FALSE,
    xaxis.at=c(0, 0.5, 1:9)*365, xaxis.lab=c(0, 0.5, 1:9), # n.risk.at
    lty.surv=c(1,2), lwd.surv=1, col.surv=c(1,1,2,2,4,4), # survival.curves
    col.ci=0, # confidence intervals not plotted
    group.names=c('Obs ','Obs tumor adh','Lev','Lev tumor adh','Lev+5FU ','Lev+5FU tumor adh'), # Change group names
    group.order=c(5,3,1,6,4,2), # order of appearance in the n.risk.at table and legend.
    extra.left.margin=6, label.n.at.risk=FALSE, draw.lines=TRUE,
    cex.axis=0.8, xlab='Years', ylab='Survival Probability', # labels
    grid=TRUE, lty.grid=1, lwd.grid=1, col.grid='bisque',
    legend=TRUE, loc.legend='bottomleft',
    cex.lab=0.8, xaxs='r', bty='L', las=1, tcl=-0.2 # other parameters passed to plot()
)
title(main='Chemotherapy for stage B/C colon cancer', adj=.1, font.main=1, line=0.5, cex.main=1)
</code></pre>
<img src="../assets/images/kmplot1.png" alt="kmplot example", width="95%">
</div>
</li>
<!-- ------ --> 
<!-- jmplot --> 
<!-- ------ --> 
<li><button onclick="toggleVisibility('jmplot-details')">jmplot</button>
<div id="jmplot-details" style="display: none;">
    <strong>jmplot()</strong> plots the joint distribution along with marginal distributions on each margin. The parameters <code class="cxx">dist</code> (which controls jitter) and <code class="cxx">jit</code> (which sets the jitter amount) are currently swapped for unknown reasons. <small>I'll fix it someday. In the meantime, ggplot2 has this <a href="https://stackoverflow.com/questions/8545035/scatterplot-with-marginal-histograms-in-ggplot2">covered</a>. </small>
    <!--        -->
<h3>Example</h3>
<pre><code class="code-block">set.seed(1220)

x <- rexp(100)
y <- rexp(100)
levels <- as.factor(sample(c("Male","Female"), 100, TRUE))
co <- c('brown','royalblue')[as.numeric(levels)]

jmplot(x, y, levels, col=co, pch=19, main='Title', show.n=TRUE)
</code></pre>

<img src="../assets/images/jmplot1.png" alt="jmplot example", width="80%">
</div>
</li>
<!-- ------ --> 
<!-- dsplot --> 
<!-- ------ --> 
<li><button onclick="toggleVisibility('dsplot-details')">dsplot</button>
<div id="dsplot-details" style="display: none;">
<p><strong>Deprecated</strong>. (Discrete scatter plot) The idea was to show continuous data with lots of ties effectively. <small>This is no longer being developed. Use jitter() function carefully.</small></p>
<!--        -->
<!-- <h3>Example</h3>
<p>This example demonstrates the available options in <strong>...</strong>.</p>
<ul>
<li>one</li>
<li>two</li>
<li>three</li>
</ul>
-->
<!--        --> 
<!-- <h3>Example</h3>
<pre><code class="code-block">x <- 3
</code></pre>
<img src="../assets/images/tplot1.png" alt="tplot example", width="80%">
</div>
</li>
-->
<!-- ----------- --> 
<!-- show.colors --> 
<!-- ----------- --> 
<li><button onclick="toggleVisibility('show.colors-details')">show.colors</button>
<div id="show.colors-details" style="display: none;">
    <strong>show.colors()</strong> shows all 657 named colors in R. You can select a color and display its name by running <code class="cxx">colors()[n]</code>.
<!--        -->
<h3>Example</h3>
<!--        --> 
<pre><code class="code-block">show.colors()
</code></pre>
<img src="../assets/images/showColors1.png" alt="show.colors()", width="80%">
<pre><code class="code-block">colors()[139]
<span class="output">
[1] "forestgreen"
</span></code></pre>
</div>
</li>
<!-- ------------ --> 
<!-- text.with.bg --> 
<!-- ------------ --> 
<li><button onclick="toggleVisibility('text.with.bg-details')">text.with.bg</button>
<div id="text.with.bg-details" style="display: none;">
    <strong>text.with.bg()</strong> adds text to a plot with a background rectangle.</p>
<!--        -->
<h3>Inputs</h3>
<h4>Main Arguments</h4>
<ul>
    <li><span class="cx">x.pos</span> Position of the text box on the x-axis (upper-left corner).</li>
    <li><span class="cx">y.pos</span> Position of the text box on the y-axis (upper-left corner).</li>
    <li><span class="cx">txt</span> The text to be displayed.</li>
</ul>
<h4>Padding & Sizing</h4>
<ul>
    <li><span class="cx">x.pad</span> Horizontal padding around the text, relative to the plot size (%).</li>
    <li><span class="cx">y.pad</span> Veritcal padding around the text, relative to the plot size (%).</li>
</ul>
<h4>Appearance</h4>
<ul>
    <li><span class="cx">col</span> Color of the text.</li>
    <li><span class="cx">bkgr</span> Background color of the text box. Set to <code class="cxx">NA</code> for transparency.</li>
    <li><span class="cx">border</span> Color of the rectangle border. Defaults to <code class="cxx">NA</code> (no border).</li>
</ul>
<h4>Additional Arguments</h4>
<ul>
    <li><span class="cx">...</span> Passed to `text()` and `strwidth()`/`strheight()`, allowing customization of font size (`cex`) and style (`font`),</li>
</ul>
<!--        -->
<h3>Example</h3>
<!-- 
data(iris)
x <- iris$Sepal.Length + rnorm(nrow(iris),0,0.05)
y <- iris$Petal.Length + rnorm(nrow(iris),0,0.10)
cc <- c('dodgerblue','darkorange','darkgreen')[as.numeric(iris$Species)]

par(bg='thistle1')
plot(x,y, xlab='Sepal Length', ylab='Petal Length', col=cc, pch=20, 
    panel.first=grid(nx=NULL, ny=NULL, col='grey80', lty=1))
title(main='Iris data', adj=0, font.main=3, line=1)
    
text.with.bg(x.pos=5.8, y.pos=2, txt=paste0('Say something','\n','interesting here.'), 
        col='royalblue', bkgr='thistle1', x.pad=2, y.pad=2, border=NA, cex=0.8, font=4, family='serif')
text.with.bg(x.pos=6.5, y.pos=4, txt=paste0('A lot of orange dots.'), 
        col='darkorange', bkgr=NA, x.pad=4, y.pad=6, border='red', cex=1.2, font=1, family='sans')
text.with.bg(x.pos=5.0, y.pos=6, txt=paste0('With background'), 
        col='ivory', bkgr='forestgreen', x.pad=4, y.pad=3, border=NA, cex=1, font=1, family='sans')

-->
<pre><code class="code-block">
set.seed(620)
x <- sample(4:14, 100, replace=TRUE) + rnorm(100,0,1)
y <- x + rnorm(100, 0, 3)
x[100] <- 15.2 ; y[100] <- 3.1

plot(x,y, xlim=c(0,20), ylim=c(0,20), panel.first=grid(nx=NULL, ny=NULL,lty=1, col='lightblue'))

txt <- paste('Say something','\n','interesting here.', sep='')
text.with.bg(x.pos=15.5, y.pos=2.5, txt=txt, col='royalblue', bkgr='thistle1', x.pad=2, y.pad=2,
              border='dodgerblue', cex=0.8, font=4, family='serif')
</code></pre>
<img src="../assets/images/textwithbg.png" alt="text.with.bg example", width="80%">
</div>
</li>

<!-- ------ --> 
<!-- tplot  -->
<!--        --> 
<!-- ------ --> 
<li>
<button onclick="toggleVisibility('tplot-details')">tplot</button>
<div id="tplot-details" style="display: none;">
    <p style="margin-bottom: 60px;"><strong>Deprecated</strong>. <code class="cxx">tplot()</code> is no longer maintained. Please use <code class="cxx">dbplot()</code> instead.</p>
<p>tplot() is an alternative to boxplot(). It allows individual data points to be displayed, either in the foreground or background, with jittering if necessary.</p>
<!--        -->
<h3>Example</h3>
This example demonstrates the various options available in <strong>tplot()</strong>. While this particular example is not the most effective way to visualize these data -due to unnecessary variation in color and point type- it highlights the function's customization features.
<ul>
    <li><code class="cxx">col</code> and <code class="cxx">pch</code> can be specified at either the individual or group level. In this example, <code class="cxx">col</code> is set at the individual level, while <code class="cxx">pch</code> is assigned at the group level, though this pch variation is unnecessary.</li>
    <li>The <code class="cxx">type</code> argument controls the plot style: <strong>b</strong> (box only), <strong>d</strong> (dots only), <strong>bd</strong> (box in front of dots), and <strong>db</strong> (dots in front of the box).</li>
    <li>Points that are closer than <code class="cxx">dist</code> are jittered by <code class="cxx">dist</code>. <small>This implementation may be incorrect. -try different values to see its impact.</small></li>
    <li>Box colors and borders are controlled by the <code class="cxx">boxcol</code> and <code class="cxx">boxborder</code> arguments.</li>
    <li>The <code class="cxx">boxplot.pars</code> argument is passed directly to <code class="cxx">boxplot()</code>, allowing further customization.</li>
    </ul>
<!--        -->
<h3>Example</h3>
<!--        -->
<pre><code class="code-block">set.seed(100)
y <- rnorm(80, 26, 9)
sex <- factor(sample(c('Female', 'Male'), 80, TRUE))
group <- paste('Group ', sample(1:4, 40, prob = c(2,5,4,1), replace = TRUE), sep='')

d <- data.frame(y, sex, group)
        rm(y,sex,group)

tplot(y ~ group, data=d, ylim=c(0,50),
    las=1, cex=1, cex.axis=1, bty='L',
    show.n=TRUE, dist=0.5, jit=0.07, type=c('b','bd','db','d'),
    group.pch=TRUE, pch=c(15,17,20,19),
    group.col=FALSE, col=c('orange','darkgreen')[c(sex)], 
    boxcol=c('dodgerblue','magenta', 'lightgrey', 'pink'), 
    boxborder=grey(0.2),
    boxplot.pars=list(notch=TRUE, boxwex=0.5)
)
</code></pre>
<!--        -->
<img src="../assets/images/tplot1.png" alt="tplot example", width="80%">
</div>
</li>

</section>
</main>
</div> <!-- End of container-box -->
</body>
</html>
