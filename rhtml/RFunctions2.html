<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misc R Functions: Tatsuki Koyama</title>
    <link rel="stylesheet" href="../assets/css/Feb2025.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
<!-- Highlight.js CSS (Choose a theme) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/idea.min.css">
<!-- Highlight.js Library -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/r.min.js"></script> -->
<!-- Initialize Highlight.js -->
<!-- <script>hljs.highlightAll();</script> -->
</head>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
<body>
    <div class="container-box">
    <div class="navbar"> 
        <nav>
        <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="../rhtml/RFunctions1.html"><img src="../assets/images/Rlogo.svg" alt="R Logo" width="20"> files</a></li>
        <li><a href="../teaching.html">Teaching</a></li>
        <li><a href="../cv.html">CV</a></li>
        </ul>
        </nav>
    </div>
<!-- ------ --> 
<main>
    <aside class="sidebar">
        <img src="../assets/images/tatsuki-koyama.png" alt="Tatsuki Koyama" class="profile-pic">
        <h2>Tatsuki Koyama</h2>
        <p><a href="https://www.vumc.org/biostatistics/">Department of Biostatistics</a><br><a href="https://vanderbilt.edu">Vanderbilt University</a><br><a href="https://www.vumc.org/main/home">Medical Center</a></p>
        <p>Nashville, TN</p>
            <ul class="social-links"> 
            <li><a href="mailto:tatsuki.koyama@vumc.org"><i class="fa-solid fa-envelope"></i> Email</a></li>
            <li><a href="https://scholar.google.com/citations?user=BEg13Y0AAAAJ&hl=en"><i class="fa-solid fa-graduation-cap"></i> Google Scholar</a></li>
            <li><a href="https://www.athlinks.com/athletes/155884025"><i class="fa fa-link"></i> Athlinks</a></li>
            </ul>
    </aside>
<!-- ------ -->
<!--        -->
<!-- ------ -->
<section class="content">
<h1>R Functions</h1>
    <div class="r-functions-links" style="display: flex; justify-content: space-around; margin-bottom: 20px;">
    <a href="RFunctions1.html">Custom Figures</a>
    <a href="RFunctions2.html">Misc Functions</a>
    <a href="TwoStage2025.html">Two-Stage Designs</a>
    <a href="Randomization.html">Randomization</a>
    </div>
<div class="r-functions-list"> 
<h2>Miscellaneous Functions</h2>
<p><a href="https://github.com/tk-koyama/rFunctions/blob/main/RFunctions2.R" target="_blank"> Download RFunctions2.R (GitHub) </a></p>
<!-- ------ -->
<!--        -->
<!-- ------ -->
<ul>
<li><button onclick="toggleVisibility('groupSum')">groupSum</button>
<div id="groupSum" style="display: none;">
    <p><strong>groupSum</strong> computes and displays a summary of a numeric vector <code class="cxx">v</code>, optionally by grouped by <code class="cxx">g</code>. Missing group IDs are treated as a separate group.</p>
<pre><code class="code-block">data(iris)
iris$Species[seq(1,150,length=20)] <- NA ## for demonstration purposes.

groupSum(v=Sepal.Length, g=Species, data=iris, select_stats=c('-SE')

<span class="output">
             N Min   Q1 Med   Q3 Max Mean    SD
setosa      43 4.3 4.80 5.0 5.20 5.8 4.98 0.353
versicolor  44 4.9 5.57 5.8 6.30 7.0 5.91 0.528
virginica   43 4.9 6.25 6.5 6.85 7.9 6.57 0.627
NA.         20 4.6 5.33 5.9 6.55 7.7 5.99 0.842
Combined   150 4.3 5.10 5.8 6.40 7.9 5.84 0.828
</span></code></pre>
</div>
</li>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
<li><button onclick="toggleVisibility('editRedCapData')">editRedCapData</button>
<div id="editRedCapData" style="display: none;">
    <strong>editRedCapData</strong> cleans the <code class="regular-code">data.frame</code> created by REDCap's .r file.
    <ul>
        <li>Delete all the numeric vectors when corresponding factor vectors are available.</li>
        <li>Delete <code class="cxx">.factor</code> from the variable names.</li>
        <li>Change <code class="cxx">.</code> to <code class="cxx">_</code> in the variable names (optional)
    </ul>
<pre><code class="code-block">d <- editRedCapData(d, changeNames=TRUE)
</code></pre>
</div>
</li>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
<li><button onclick="toggleVisibility('multTime')">multTime</button>
<div id="multTime" style="display: none;">
    <strong>multTime</strong> multiplies a time value, <code class="cxx">lap</code>, by <code class="cxx">multiplier</code>.<br>This function answers questions such as: <em>If I run 4:12/km for 42.195km, how long will it take?</em> 
    <ul><li>The <code class="cxx">lap</code> argument can be specified in "HH:MM:SS" or "MM:SS" format (character string) or MM.SS format (numeric).</li></ul>
<!--        --> 
<pre><code class="code-block">multTime(lap=4.12, multiplier=42.195)
# multTime(lap='4:12', multiplier=42.195) # Same
<span class="output">
[1] "2:57:13"</span></code></pre>
</div>
</li>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
<li><button onclick="toggleVisibility('addTime')">addTime</button>
<div id="addTime" style="display: none;">
    <strong>addTime</strong> sums time values from the vector <code class="cxx">times</code>, which can be specified in "HH:MM:SS" or "MM:SS" format (character string) or MM.SS format (numeric).
    <ul><li>The outputs of <strong>multTime</strong> and <strong>addTime</strong> can be used as inputs for this function. For example, to answer <em>If I run 4:02/km for 5km, then 3:55/km for 7km, what is the total time?</em></li></ul>
<!--        --> 
<pre><code class="code-block">addTime( c(multTime("4:02",5), multTime(3.55,7)))

<span class="output">[1] "47:35"</span></code></pre>
</div>
</li>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
<li><button onclick="toggleVisibility('BinPower')">BinPower</button>
    <div id="BinPower" style="display: none;">
        <strong>BinPower</strong> finds the critical value(s) for one-sample Binomial test.
        <ul><li><code class="cxx">Xcr</code> in the output is the critical value (inclusive). H<sub>0</sub> is rejected if X is <code class="cxx">Xcr_high</code> or higher, or X is <code class="cxx">Xcr_low</code> or lower. 
            </li>
            <pre><code class="code-block">BinPower(n=50, p0=0.2, p1=0.4, alp=0.05, two.sided=FALSE)
<span class="output">
   n  p0  p1  alp two.sided Xcr_low Xcr_high  typeI Power
1 50 0.2 0.4 0.05     FALSE      NA       16 0.0308 0.904
</span></code></pre>
<li>For two-sided test, type I error rate, <code class="cxx">alp</code>, is divided by 2.</li></ul>
            <pre><code class="code-block">BinPower(n=50, p0=0.2, p1=0.4, alp=0.05, two.sided=TRUE)
<span class="output">
   n  p0  p1  alp two.sided Xcr_low Xcr_high  typeI Power
1 50 0.2 0.4 0.05      TRUE       4       17 0.0329 0.844
</span></code></pre>
</div>
</li>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
<li><button onclick="toggleVisibility('Beta')">Beta Distribution</button>
    <div id="Beta" style="display: none;">
        <strong>Beta distribution</strong>. These four functions are used for Beta distributions. <code class="cxx">a</code> and <code class="cxx">b</code> are the two parameters.
        <ul>
            <li><code class="cx">BetaMS(a, b)</code> calculates the mean, variance, and standard deviation of a Beta(<code class="cxx">a</code>, <code class="cxx">b</code>) distribution.</li>
            <li><code class="cx">plotBetaDis(a, b)</code> plots the density function given <code class="cxx">a</code> and <code class="cxx">b</code>.</li>
            <li><code class="cx">BetaParameters(m, v)</code> solves for <code class="cxx">a</code> and <code class="cxx">b</code> given the mean and variance of the distribution. <small>I use this function when I need to simulate probabilities.</small></li>
            <li><code class="cx">BetaCI(a, b, x, n, p)</code> computes a 100*<code class="cxx">p</code>% credible interval given Beta(<code class="cxx">a</code>, <code class="cxx">b</code>) as the prior distribution and "<code class="cxx">x</code> successes out <code class="cxx">n</code>" as the data.</li>
        </ul>
<pre><code class="code-block">BetaMS(a=29, b=11)
<span class="output">
   a  b  mean     var     sd
1 29 11 0.725 0.00486 0.0697
</span></code></pre>

<pre><code class="code-block">plotBetaDis(a=4, b=21, xlim=c(0, 0.5), yaxs='i')
</code></pre>

<pre><code class="code-block">BetaParameters(m=0.4, v=0.02, PLOT=FALSE)
<span class="output">
[1] 4.4 6.6
</span></code></pre>

<pre><code class="code-block">BetaCI(a=4.4, b=6.6, x=8, n=15, p=0.95)
<span class="output">
  prior_a prior_b successes trials cred_level lower median upper
1     4.4     6.6         8     15        95% 0.292  0.476 0.665
</span></code></pre>
</div>
</li>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
<li><button onclick="toggleVisibility('survivalParam')">Survival Parameters</button>
    <div id="survivalParam" style="display: none;">
        <strong>Survival Parameters</strong>. These functions convert survival parameters assuming a constant hazard, as in the exponential survival model.

<ul> 
    <li><code class="cx">ps2hr(prop, Time)</code> converts proportion surviving (at Time = <code class="cxx">Time</code>) to hazard rate.</li>
    <li><code class="cx">ms2hr(ms)</code> converts median survival to hazard rate.</li> 
    <li><code class="cx">hr2ms(hr)</code> converts hazard rate to median survival.</li> 
    <li><code class="cx">ps2ms(prop, Time)</code> converts proportion surviving (at Time = <code class="cxx">Time</code>) to median survival.</li> 
    <li><code class="cx">ms2ps(ms, Time)</code> converts median survival to proportion surviving.</li> 
    <li><code class="cx">hr2ps(hr, Time)</code> converts hazard rate to proportion surviving.</li> 
</ul>

<br>What is the one-year survival proportion if the median survival is 5 months?
<pre><code class="code-block">ms2ps(ms=5, Time=12)
<span class="output">
[1] 0.189
</span></code></pre>
</div>
</li>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
<li><button onclick="toggleVisibility('myKindaDay')">My kind of day!</button>
    <div id="myKindaDay" style="display: none;">
        <strong>myKindaDay</strong> takes a regular R 'date' element and changes it to "yyyy/mm/dd" with no leading zeros <small>(which is most common in Japan)</small>. 
<pre><code class="code-block">as.Date('1999-6-20')
<span class="output">
[1] "1999-06-20"
</span></code></pre>

<pre><code class="code-block">myKindaDay(as.Date('1999-6-20'))
<span class="output">
[1] "1999/6/20"
</span></code></pre>
</div>
</li>
<!-- ------ --> 
<!--        --> 
<!-- ------ --> 
</ul>
</section>
</main>
</div> <!-- End of container-box -->
    <script>
        function toggleVisibility(id) {
            var element = document.getElementById(id);
            if (element.style.display === "none") {
                element.style.display = "block";
            } else {
                element.style.display = "none";
            }
        }
    </script>
</body>
</html>
